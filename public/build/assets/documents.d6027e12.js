import{r as u,c8 as j}from"./index.42933e75.js";function F(g={}){const{thumbnailScale:b=.5,enableDflip:v=!0,cdnBaseUrl:p="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174",storageBaseUrl:d=window.location.origin+"/storage",filters:D={type:"document"}}=g;u(null);const i=u([]),s=u(!1),h=u(null),l=j(),L=async()=>{if(window.pdfjsLib)return window.pdfjsLib;try{return await Promise.all([new Promise(n=>{const t=document.createElement("script");t.src=`${p}/pdf.min.js`,t.onload=n,document.head.appendChild(t)}),new Promise(n=>{const t=document.createElement("script");t.src=`${p}/pdf.worker.min.js`,t.onload=n,document.head.appendChild(t)})]),await new Promise(n=>setTimeout(n,100)),window.pdfjsLib}catch(n){throw console.error("Failed to load PDF.js",n),n}},m=async(n,t=b)=>{try{const e=await L(),o=`${d}/${n}`,w=await(await e.getDocument(o).promise).getPage(1),c=document.createElement("canvas"),f=w.getViewport({scale:t}),y=c.getContext("2d");return c.width=f.width,c.height=f.height,await w.render({canvasContext:y,viewport:f}).promise,c.toDataURL("image/jpeg",.8)}catch(e){return console.error("Error generating thumbnail:",e),null}};return{documents:i,loading:s,error:h,processDocuments:async n=>{s.value=!0;try{const t=await n();for(const e of t)if(e.slug=e.slug||e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),!e.thumbnail_path&&e.publication_file.toLowerCase().endsWith(".pdf")){const o=await m(e.publication_file);e.thumb=o||void 0}else e.thumbnail_path&&(e.thumb=`${d}/${e.thumbnail_path}`);return i.value=t,s.value=!1,t}catch(t){return s.value=!1,h.value=t instanceof Error?t:new Error(String(t)),console.error(t),[]}},initializeDflip:(n=i.value)=>{var t;if(!v||!n.length)return!1;if(n.forEach(e=>{e.publication_file.toLowerCase().endsWith(".pdf")&&(window[`df_option_${e.id}`]={source:`${d}/${e.publication_file}`,outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,direction:"1",slug:e.slug,wpOptions:"true",id:e.id})}),(t=window.DFLIP)!=null&&t.parseBooks){if(window.DFLIP.parseBooks(),l.currentRoute.value.hash){if(l.currentRoute.value.hash==="#_"){l.replace({hash:""});return}const e=n.find(o=>l.currentRoute.value.hash.includes(o.slug));e&&document.getElementById(`df_${e.id}`).click()}return!0}return console.warn("DFLIP library not loaded"),!1},generateThumbnail:m,handleRouteLeave:(n,t,e)=>{var a;const o=document.querySelector(".df-lightbox-wrapper"),r=o&&o.style.display!=="none";if(window.DFLIP&&r)return(a=document.querySelector(".df-lightbox-close"))==null||a.click(),e(!1),!1;e()},filterDocuments:(n="")=>i.value.filter(t=>{const e=Object.entries(D).every(([r,a])=>t[r]===a),o=!n||Object.values(t).some(r=>String(r).toLowerCase().includes(n.toLowerCase()));return e&&o})}}export{F as u};
