import{z}from"./Marker.vue_vue_type_script_lang-014a8665.3603bef3.js";import{s as E}from"./_plugin-vue_export-helper-dad06003.469021ef.js";import{d as y,L as b,r as O,w as x,o as F,O as L,bM as j,bE as g,bF as f,aa as k,bN as S,bU as w}from"./index.a30bd750.js";import"./tools-b40e92cf.4881bf31.js";import"./_commonjsHelpers.f037b798.js";const Z=(e,t,l)=>{const c=1<<t;let n=Math.sin(e.lat*Math.PI/180);n=Math.min(Math.max(n,-.9999),.9999);const a=.5+e.lng/360,o=.5-Math.log((1+n)/(1-n))/(4*Math.PI),s=Math.floor(a*c/l),r=Math.floor(o*c/l);return{x:s,y:r}},N=e=>{const t=e.length,l={lat:0,lng:0},c=e.reduce((n,a)=>({lat:n.lat+a.lat,lng:n.lng+a.lng}),l);return{lat:c.lat/t,lng:c.lng/t}},T=(e,t,l,c)=>{const n={};if(t>=l)e.forEach((a,o)=>n[o]={position:a,items:[a]});else{e.forEach(a=>{const o=Z(a,t,c),s=`${t}-${o.x}-${o.y}`;n[s]||(n[s]={position:{lat:0,lng:0},items:[]}),n[s].items.push(a)});for(const[a,o]of Object.entries(n))n[a].position=N(o.items),n[a].weight=Math.round(o.items.length/e.length*100)}return n},G=e=>{const t=new globalThis.google.maps.LatLngBounds(e[0],e[0]);return e.forEach(l=>t.extend(l)),t},I=(e,t=.1)=>{const l={lat:e.north-e.south,lng:e.east-e.west},c=Math.min(e.north+t*l.lat,89),n=Math.max(e.south-t*l.lat,-89),a=Math.max(e.west-t*l.lng,-180),o=Math.max(e.east+t*l.lng,180);return{north:c,south:n,east:o,west:a}},q=(e,t)=>!(t.lat>e.north||t.lat<e.south||t.lng>e.east||t.lng<e.west),B={minZoom:-1,maxZoom:20,tileSize:.5,highPercentage:10,lowPercentage:3},U=y({name:"GmapsCluster",components:{GmapsMarker:z},props:{items:{type:Object,required:!0},options:{type:Object,default:()=>({})}},emits:{click:e=>!0},setup(e,{emit:t}){const l=b("$getMap"),c=b("$handleError"),n=i=>c(i,"Cluster"),a=[];let o={...B,...e.options},s={},r=O({});const u=i=>{const p=G(r.value[i].items);l().fitBounds(p),t("click",r.value[i].position)},m=()=>{const i=l().getBounds();if(!i)return n(new Error("No map bounds."));const p=I(i.toJSON()),C={},$=Math.floor(Math.random()*1e4);for(const[v,M]of Object.entries(s))q(p,M.position)&&(C[`${v}-${$}`]=M);r.value=C},h=()=>{const i=l().getZoom();i&&(s=T(e.items,Math.max(i,o.minZoom||0),o.maxZoom,o.tileSize))},P=i=>{if(i!==void 0&&!(!o.highPercentage&&!o.lowPercentage))return o.highPercentage&&i>=o.highPercentage?"#FBB3BD":o.lowPercentage&&i<=o.lowPercentage?"#CCF1FF":"#F1E0B0"},d=l();return x(()=>e.items,i=>{h(),m()},{deep:!0}),x(()=>e.options,i=>{o={...B,...i},h(),m()},{deep:!0}),F(()=>{try{h(),a.push(d.addListener("idle",()=>m()),d.addListener("zoom_changed",()=>h()))}catch{n(new Error("There was a problem creating the cluster."))}}),L(()=>{a.forEach(i=>i.remove())}),{clusters:r,getColor:P,zoomToCluster:u}}});function A(e,t,l,c,n,a){const o=j("gmaps-marker");return g(),f("div",null,[(g(!0),f(k,null,S(e.clusters,({position:s,items:r,weight:u},m)=>(g(),f(k,null,[r.length>1?(g(),w(o,{key:`c-${m}`,label:{text:`${r.length}`,fontSize:"20px",color:"#333"},position:s,icon:{path:"M0-31.15c5.58-.17 10.24 4.20 10.41 9.77.12 4.00-2.11 7.51-5.42 9.24L.01-.01C-1.75-3.94-3.35-7.94-4.92-11.95c-3.33-1.56-5.70-4.89-5.82-8.81-.17-5.57 4.21-10.22 9.78-10.39z",scale:2,fillColor:e.getColor(u),fillOpacity:.85,strokeColor:"#fff",strokeWeight:1,labelOrigin:{x:0,y:-21}},onClick:h=>e.zoomToCluster(m)},null,8,["label","position","icon","onClick"])):(g(),w(o,{key:`m-${m}`,position:s,title:r[0].title||r[0].id,visible:r[0].visible,icon:r[0].icon,label:r[0].label,onClick:h=>r[0].onClick?r[0].onClick(s):null,onContextmenu:h=>r[0].onContextmenu?r[0].onContextmenu(s):null},null,8,["position","title","visible","icon","label","onClick","onContextmenu"]))],64))),256))])}const K=E(U,[["render",A]]);export{K as default};
