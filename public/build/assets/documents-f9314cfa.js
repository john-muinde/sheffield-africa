import{r as m,c6 as C}from"./index-48339136.js";function B(y={}){const{thumbnailScale:D=.5,enableDflip:j=!0,cdnBaseUrl:g="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174",storageBaseUrl:f=window.location.origin+"/storage",filters:L={type:"document"}}=y,u=m([]),p=m(!1),w=m(null),d=C(),P=async()=>{if(window.pdfjsLib)return window.pdfjsLib;try{return await Promise.all([new Promise(n=>{const e=document.createElement("script");e.src=`${g}/pdf.min.js`,e.onload=n,document.head.appendChild(e)}),new Promise(n=>{const e=document.createElement("script");e.src=`${g}/pdf.worker.min.js`,e.onload=n,document.head.appendChild(e)})]),await new Promise(n=>setTimeout(n,100)),window.pdfjsLib}catch(n){throw console.error("Failed to load PDF.js",n),n}},b=async(n,e=D)=>{try{const t=await P(),r=`${f}/${n}`,c=await(await t.getDocument(r).promise).getPage(1),s=document.createElement("canvas"),o=c.getViewport({scale:e}),h=s.getContext("2d");return s.width=o.width,s.height=o.height,await c.render({canvasContext:h,viewport:o}).promise,s.toDataURL("image/jpeg",.8)}catch(t){return console.error("Error generating thumbnail:",t),null}},_=async(n,e="height")=>{p.value=!0;try{const r=(await n()).map(async i=>{i.slug=i.slug||i.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");let c=0,s=0,o=1,h="unknown";try{if(!i.thumbnail_path&&i.publication_file.toLowerCase().endsWith(".pdf")){const l=await b(i.publication_file);i.thumb=l||void 0}else i.thumbnail_path&&(i.thumb=`${f}/${i.thumbnail_path}`);if(i.thumb&&e==="height"){const l=x(i.thumb);l&&(s=l.width||1,c=l.height||1,o=s===0?1/0:c/s,o>1?h="portrait":o<1?h="landscape":h="square")}}catch(l){console.error(`Error processing thumbnail for ${i.name}:`,l)}return{...i,height:c,width:s,heightWidthRatio:parseFloat(o.toFixed(2)),orientation:h}}),a=await Promise.all(r);return e==="height"?u.value=E(a):u.value=a,p.value=!1,u.value}catch(t){return p.value=!1,w.value=t instanceof Error?t:new Error(String(t)),[]}},v=n=>{if(n.thumbnail_path){const r=Object.values({"a4-portrait":794,"a4-landscape":560,"letter-portrait":792,"letter-landscape":612}).find(a=>n.thumbnail_path.includes(String(a)));if(r)return r}const e={brochure:300,newsletter:250,catalog:400,default:200};return e[n.type]||e.default},E=n=>n.sort((e,t)=>{const r=e.thumbnailHeight||v(e);return(t.thumbnailHeight||v(t))-r}),F=(n=u.value)=>{var e;if(!j||!n.length)return!1;if(n.forEach(t=>{t.publication_file.toLowerCase().endsWith(".pdf")&&(window[`df_option_${t.id}`]={source:`${f}/${t.publication_file}`,outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,height:"100",direction:"1",slug:t.slug,wpOptions:"true",id:t.id})}),(e=window.DFLIP)!=null&&e.parseBooks){if(window.DFLIP.parseBooks(),d.currentRoute.value.hash){if(d.currentRoute.value.hash==="#_"){d.replace({hash:""});return}const t=n.find(r=>d.currentRoute.value.hash.includes(r.slug));t&&document.getElementById(`df_${t.id}`).click()}return!0}return console.warn("DFLIP library not loaded"),!1},$=(n,e)=>{var a;const t=document.querySelector(".df-lightbox-wrapper"),r=t&&t.style.display!=="none";return window.DFLIP&&r?((a=document.querySelector(".df-lightbox-close"))==null||a.click(),!1):!0},k=(n="")=>u.value.filter(e=>{const t=Object.entries(L).every(([a,i])=>e[a]===i),r=!n||Object.values(e).some(a=>String(a).toLowerCase().includes(n.toLowerCase()));return t&&r}),x=n=>{const e=n.split("-").pop().split(".jpg")[0].split("x");if(e.length===2){const t=parseFloat(e[0],10),r=parseFloat(e[1],10);if(!isNaN(t)&&!isNaN(r))return{width:t,height:r}}return null};return{documents:u,loading:p,error:w,processDocuments:_,initializeDflip:F,generateThumbnail:b,handleRouteLeave:$,filterDocuments:k}}export{B as u};
