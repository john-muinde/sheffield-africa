import{r as f,c6 as _}from"./index-616505bb.js";function C(b={}){const{thumbnailScale:v=.5,enableDflip:y=!0,cdnBaseUrl:m="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174",storageBaseUrl:d=window.location.origin+"/storage",filters:D={type:"document"}}=b,l=f([]),h=f(!1),w=f(null),p=_(),L=async()=>{if(window.pdfjsLib)return window.pdfjsLib;try{return await Promise.all([new Promise(n=>{const t=document.createElement("script");t.src=`${m}/pdf.min.js`,t.onload=n,document.head.appendChild(t)}),new Promise(n=>{const t=document.createElement("script");t.src=`${m}/pdf.worker.min.js`,t.onload=n,document.head.appendChild(t)})]),await new Promise(n=>setTimeout(n,100)),window.pdfjsLib}catch(n){throw console.error("Failed to load PDF.js",n),n}},g=async(n,t=v)=>{try{const e=await L(),i=`${d}/${n}`,u=await(await e.getDocument(i).promise).getPage(1),a=document.createElement("canvas"),s=u.getViewport({scale:t}),o=a.getContext("2d");return a.width=s.width,a.height=s.height,await u.render({canvasContext:o,viewport:s}).promise,a.toDataURL("image/jpeg",.8)}catch(e){return console.error("Error generating thumbnail:",e),null}},P=async(n,t="height")=>{h.value=!0;try{const i=(await n()).map(async r=>{r.slug=r.slug||r.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");let c=0,u=0,a=1,s="unknown";try{if(!r.thumbnail_path&&r.publication_file.toLowerCase().endsWith(".pdf")){const o=await g(r.publication_file);r.thumb=o||void 0}else r.thumbnail_path&&(r.thumb=`${d}/${r.thumbnail_path}`);if(r.thumb&&t==="height"){const o=R(r.thumb);o&&(u=o.width||1,c=o.height||1,a=u===0?1/0:c/u,a>1?s="portrait":a<1?s="landscape":s="square")}}catch(o){console.error(`Error processing thumbnail for ${r.name}:`,o)}return{...r,height:c,width:u,heightWidthRatio:parseFloat(a.toFixed(2)),orientation:s}});return l.value=await Promise.all(i),t==="height"&&(l.value=j(l.value)),h.value=!1,l.value}catch(e){return h.value=!1,w.value=e instanceof Error?e:new Error(String(e)),[]}},j=n=>n.sort((t,e)=>e.heightWidthRatio-t.heightWidthRatio),F=(n=l.value)=>{var t;if(!y||!n.length)return!1;if(n.forEach(e=>{e.publication_file.toLowerCase().endsWith(".pdf")&&(window[`df_option_${e.id}`]={source:`${d}/${e.publication_file}`,outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,height:"100",direction:"1",slug:e.slug,wpOptions:"true",id:e.id})}),(t=window.DFLIP)!=null&&t.parseBooks){if(window.DFLIP.parseBooks(),p.currentRoute.value.hash){if(p.currentRoute.value.hash==="#_"){p.replace({hash:""});return}const e=n.find(i=>p.currentRoute.value.hash.includes(i.slug));e&&document.getElementById(`df_${e.id}`).click()}return!0}return console.warn("DFLIP library not loaded"),!1},$=(n,t)=>{var r;const e=document.querySelector(".df-lightbox-wrapper"),i=e&&e.style.display!=="none";return window.DFLIP&&i?((r=document.querySelector(".df-lightbox-close"))==null||r.click(),!1):!0},E=(n="")=>l.value.filter(t=>{const e=Object.entries(D).every(([r,c])=>t[r]===c),i=!n||Object.values(t).some(r=>String(r).toLowerCase().includes(n.toLowerCase()));return e&&i}),R=n=>{const t=n.split("-").pop().split(".jpg")[0].split("x");if(t.length===2){const e=parseFloat(t[0],10),i=parseFloat(t[1],10);if(!isNaN(e)&&!isNaN(i))return{width:e,height:i}}return null};return{documents:l,loading:h,error:w,processDocuments:P,initializeDflip:F,generateThumbnail:g,handleRouteLeave:$,filterDocuments:E}}export{C as u};
