import{v as l}from"./index-27321865.js";import{z as w}from"./Marker.vue_vue_type_script_lang-014a8665-13d180e0.js";import{s as b}from"./_plugin-vue_export-helper-dad06003-f875bd67.js";import"./_commonjsHelpers-23102255.js";import"./tools-b40e92cf-d03b1370.js";const v=(e,t,i)=>{const m=1<<t;let n=Math.sin(e.lat*Math.PI/180);n=Math.min(Math.max(n,-.9999),.9999);const r=.5+e.lng/360,o=.5-Math.log((1+n)/(1-n))/(4*Math.PI),c=Math.floor(r*m/i),s=Math.floor(o*m/i);return{x:c,y:s}},E=e=>{const t=e.length,i={lat:0,lng:0},m=e.reduce((n,r)=>({lat:n.lat+r.lat,lng:n.lng+r.lng}),i);return{lat:m.lat/t,lng:m.lng/t}},P=(e,t,i,m)=>{const n={};if(t>=i)e.forEach((r,o)=>n[o]={position:r,items:[r]});else{e.forEach(r=>{const o=v(r,t,m),c=`${t}-${o.x}-${o.y}`;n[c]||(n[c]={position:{lat:0,lng:0},items:[]}),n[c].items.push(r)});for(const[r,o]of Object.entries(n))n[r].position=E(o.items),n[r].weight=Math.round(o.items.length/e.length*100)}return n},$=e=>{const t=new globalThis.google.maps.LatLngBounds(e[0],e[0]);return e.forEach(i=>t.extend(i)),t},z=(e,t=.1)=>{const i={lat:e.north-e.south,lng:e.east-e.west},m=Math.min(e.north+t*i.lat,89),n=Math.max(e.south-t*i.lat,-89),r=Math.max(e.west-t*i.lng,-180),o=Math.max(e.east+t*i.lng,180);return{north:m,south:n,east:o,west:r}},y=(e,t)=>!(t.lat>e.north||t.lat<e.south||t.lng>e.east||t.lng<e.west),C={minZoom:-1,maxZoom:20,tileSize:.5,highPercentage:10,lowPercentage:3},j=l.defineComponent({name:"GmapsCluster",components:{GmapsMarker:w},props:{items:{type:Object,required:!0},options:{type:Object,default:()=>({})}},emits:{click:e=>!0},setup(e,{emit:t}){const i=l.inject("$getMap"),m=l.inject("$handleError"),n=a=>m(a,"Cluster"),r=[];let o={...C,...e.options},c={},s=l.ref({});const u=a=>{const p=$(s.value[a].items);i().fitBounds(p),t("click",s.value[a].position)},h=()=>{const a=i().getBounds();if(!a)return n(new Error("No map bounds."));const p=z(a.toJSON()),d={},x=Math.floor(Math.random()*1e4);for(const[B,k]of Object.entries(c))y(p,k.position)&&(d[`${B}-${x}`]=k);s.value=d},g=()=>{const a=i().getZoom();a&&(c=P(e.items,Math.max(a,o.minZoom||0),o.maxZoom,o.tileSize))},M=a=>{if(a!==void 0&&!(!o.highPercentage&&!o.lowPercentage))return o.highPercentage&&a>=o.highPercentage?"#FBB3BD":o.lowPercentage&&a<=o.lowPercentage?"#CCF1FF":"#F1E0B0"},f=i();return l.watch(()=>e.items,a=>{g(),h()},{deep:!0}),l.watch(()=>e.options,a=>{o={...C,...a},g(),h()},{deep:!0}),l.onMounted(()=>{try{g(),r.push(f.addListener("idle",()=>h()),f.addListener("zoom_changed",()=>g()))}catch{n(new Error("There was a problem creating the cluster."))}}),l.onBeforeUnmount(()=>{r.forEach(a=>a.remove())}),{clusters:s,getColor:M,zoomToCluster:u}}});function F(e,t,i,m,n,r){const o=l.resolveComponent("gmaps-marker");return l.openBlock(),l.createElementBlock("div",null,[(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(e.clusters,({position:c,items:s,weight:u},h)=>(l.openBlock(),l.createElementBlock(l.Fragment,null,[s.length>1?(l.openBlock(),l.createBlock(o,{key:`c-${h}`,label:{text:`${s.length}`,fontSize:"20px",color:"#333"},position:c,icon:{path:"M0-31.15c5.58-.17 10.24 4.20 10.41 9.77.12 4.00-2.11 7.51-5.42 9.24L.01-.01C-1.75-3.94-3.35-7.94-4.92-11.95c-3.33-1.56-5.70-4.89-5.82-8.81-.17-5.57 4.21-10.22 9.78-10.39z",scale:2,fillColor:e.getColor(u),fillOpacity:.85,strokeColor:"#fff",strokeWeight:1,labelOrigin:{x:0,y:-21}},onClick:g=>e.zoomToCluster(h)},null,8,["label","position","icon","onClick"])):(l.openBlock(),l.createBlock(o,{key:`m-${h}`,position:c,title:s[0].title||s[0].id,visible:s[0].visible,icon:s[0].icon,label:s[0].label,onClick:g=>s[0].onClick?s[0].onClick(c):null,onContextmenu:g=>s[0].onContextmenu?s[0].onContextmenu(c):null},null,8,["position","title","visible","icon","label","onClick","onContextmenu"]))],64))),256))])}const G=b(j,[["render",F]]);export{G as default};
