import{r as i,w as D,o as P,bO as N,bG as l,bH as u,bI as a,e as T,bT as E,bW as p,bN as m,W as B,a3 as F,ac as I,bP as M,bM as O,n as y}from"./index.1aefaaac.js";import{C as f}from"./ContentState.1c758d49.js";import"./use-meta.52d55950.js";import"./_commonjsHelpers.f037b798.js";import"./_plugin-vue_export-helper.cdc0426e.js";import"./transition.2c918c79.js";const S={class:"main"},z={class:"page-content"},V={class:"container"},$={class:"row"},U={class:"col-lg-10 offset-lg-1"},W=["href","data-slug","data-title","id","data-df-option","thumb"],Q={__name:"Media_Newsletters",setup(G){const n=i([]),r=i(!1),w=i(null),b=i(null),g=i(null),h=i(!1),k=async()=>(window.pdfjsLib||(await Promise.all([new Promise(e=>{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",t.onload=e,document.head.appendChild(t)}),new Promise(e=>{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",t.onload=e,document.head.appendChild(t)})]),await new Promise(e=>setTimeout(e,100))),window.pdfjsLib),C=async(e,t=.5)=>{try{const _=await(await(await k()).getDocument(e).promise).getPage(1),c=_.getViewport({scale:t}),d=g.value,x=d.getContext("2d");return d.width=c.width,d.height=c.height,await _.render({canvasContext:x,viewport:c}).promise,d.toDataURL("image/jpeg",.8)}catch(s){return console.error("Error generating thumbnail:",s),null}},L=()=>{!n.value.length||h.value||(n.value.forEach(e=>{window[`df_option_${e.id}`]={source:"/storage/"+e.publication_file,outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,direction:"1",slug:e.slug,wpOptions:"true",id:e.id}}),y(()=>{const e=b.value;e&&e.children.length===n.value.length&&(window.DFLIP&&window.DFLIP.parseBooks?(window.DFLIP.parseBooks(),h.value=!0,console.log("DFlip books initialized successfully")):console.warn("DFLIP library not loaded"))}))},j=async()=>{r.value=!0;try{const t=(await axios.get("/api/get-media-center",{})).data.newsletters;for(const s of t){s.slug=s.name.toLowerCase().replace(/ /g,"-");const o="/storage/"+s.publication_file,v=await C(o);s.thumb=v||null}n.value=t,r.value=!1}catch(e){r.value=!1,w.value=e,console.error(e)}};return D(n,e=>{e.length>0&&y(()=>{L()})},{deep:!0}),P(async()=>{await j()}),(e,t)=>{const s=N("router-link");return l(),u("div",null,[a("main",S,[a("div",z,[a("div",V,[a("div",$,[a("div",U,[t[1]||(t[1]=a("h2",{class:"about-us-title"},"Newsletters",-1)),T(s,{to:"/media",class:"btn btn-primary btn-round btn-shadow float-right"},{default:E(()=>t[0]||(t[0]=[a("i",{class:"icon-long-arrow-left"},null,-1),a("span",null,"Back to Media Center",-1)])),_:1}),t[2]||(t[2]=a("p",{class:"lead about-us-lead text-primary mb-1"}," Explore Our Newsletters ",-1)),t[3]||(t[3]=a("p",{class:"about-us-text mb-2"}," Click on the documents to view ",-1)),r.value?(l(),p(f,{key:0,type:"loading",contentType:"NewsLetters"})):m("",!0),!n.value.length&&!r.value?(l(),p(f,{key:1,type:"empty",contentType:"NewsLetters"})):m("",!0),w.value?(l(),p(f,{key:2,type:"error",contentType:"NewsLetters"})):m("",!0),B(a("div",{class:"dflip-books row media-center",id:"dflip-books",ref_key:"bookContainer",ref:b},[(l(!0),u(I,null,M(n.value,o=>(l(),u("a",{key:o.id,href:`/media/newsletters#${o.slug}/`,class:"_df_thumb","data-slug":o.slug,"data-title":o.name,id:`df_${o.id}`,"data-df-option":`df_option_${o.id}`,thumb:o.thumb},O(o.name),9,W))),128))],512),[[F,n.value.length]]),a("canvas",{ref_key:"thumbnailCanvas",ref:g,style:{display:"none"}},null,512)])])])])])])}}};export{Q as default};
