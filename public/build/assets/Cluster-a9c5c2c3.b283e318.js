import{z as v}from"./Marker.vue_vue_type_script_lang-014a8665.376b62dc.js";import{s as y}from"./_plugin-vue_export-helper-dad06003.469021ef.js";import{d as E,l as M,z as O,w as x,o as j,q as F,bx as L,bo as g,bp as f,S as k,by as S,bT as w}from"./app-setting.9d0591ca.js";import"./tools-b40e92cf.4881bf31.js";import"./_commonjsHelpers.f037b798.js";const T=(e,t,l)=>{const c=1<<t;let n=Math.sin(e.lat*Math.PI/180);n=Math.min(Math.max(n,-.9999),.9999);const i=.5+e.lng/360,o=.5-Math.log((1+n)/(1-n))/(4*Math.PI),s=Math.floor(i*c/l),r=Math.floor(o*c/l);return{x:s,y:r}},Z=e=>{const t=e.length,l={lat:0,lng:0},c=e.reduce((n,i)=>({lat:n.lat+i.lat,lng:n.lng+i.lng}),l);return{lat:c.lat/t,lng:c.lng/t}},q=(e,t,l,c)=>{const n={};if(t>=l)e.forEach((i,o)=>n[o]={position:i,items:[i]});else{e.forEach(i=>{const o=T(i,t,c),s=`${t}-${o.x}-${o.y}`;n[s]||(n[s]={position:{lat:0,lng:0},items:[]}),n[s].items.push(i)});for(const[i,o]of Object.entries(n))n[i].position=Z(o.items),n[i].weight=Math.round(o.items.length/e.length*100)}return n},G=e=>{const t=new globalThis.google.maps.LatLngBounds(e[0],e[0]);return e.forEach(l=>t.extend(l)),t},I=(e,t=.1)=>{const l={lat:e.north-e.south,lng:e.east-e.west},c=Math.min(e.north+t*l.lat,89),n=Math.max(e.south-t*l.lat,-89),i=Math.max(e.west-t*l.lng,-180),o=Math.max(e.east+t*l.lng,180);return{north:c,south:n,east:o,west:i}},N=(e,t)=>!(t.lat>e.north||t.lat<e.south||t.lng>e.east||t.lng<e.west),B={minZoom:-1,maxZoom:20,tileSize:.5,highPercentage:10,lowPercentage:3},A=E({name:"GmapsCluster",components:{GmapsMarker:v},props:{items:{type:Object,required:!0},options:{type:Object,default:()=>({})}},emits:{click:e=>!0},setup(e,{emit:t}){const l=M("$getMap"),c=M("$handleError"),n=a=>c(a,"Cluster"),i=[];let o={...B,...e.options},s={},r=O({});const u=a=>{const p=G(r.value[a].items);l().fitBounds(p),t("click",r.value[a].position)},m=()=>{const a=l().getBounds();if(!a)return n(new Error("No map bounds."));const p=I(a.toJSON()),C={},P=Math.floor(Math.random()*1e4);for(const[$,b]of Object.entries(s))N(p,b.position)&&(C[`${$}-${P}`]=b);r.value=C},h=()=>{const a=l().getZoom();a&&(s=q(e.items,Math.max(a,o.minZoom||0),o.maxZoom,o.tileSize))},z=a=>{if(a!==void 0&&!(!o.highPercentage&&!o.lowPercentage))return o.highPercentage&&a>=o.highPercentage?"#FBB3BD":o.lowPercentage&&a<=o.lowPercentage?"#CCF1FF":"#F1E0B0"},d=l();return x(()=>e.items,a=>{h(),m()},{deep:!0}),x(()=>e.options,a=>{o={...B,...a},h(),m()},{deep:!0}),j(()=>{try{h(),i.push(d.addListener("idle",()=>m()),d.addListener("zoom_changed",()=>h()))}catch{n(new Error("There was a problem creating the cluster."))}}),F(()=>{i.forEach(a=>a.remove())}),{clusters:r,getColor:z,zoomToCluster:u}}});function D(e,t,l,c,n,i){const o=L("gmaps-marker");return g(),f("div",null,[(g(!0),f(k,null,S(e.clusters,({position:s,items:r,weight:u},m)=>(g(),f(k,null,[r.length>1?(g(),w(o,{key:`c-${m}`,label:{text:`${r.length}`,fontSize:"20px",color:"#333"},position:s,icon:{path:"M0-31.15c5.58-.17 10.24 4.20 10.41 9.77.12 4.00-2.11 7.51-5.42 9.24L.01-.01C-1.75-3.94-3.35-7.94-4.92-11.95c-3.33-1.56-5.70-4.89-5.82-8.81-.17-5.57 4.21-10.22 9.78-10.39z",scale:2,fillColor:e.getColor(u),fillOpacity:.85,strokeColor:"#fff",strokeWeight:1,labelOrigin:{x:0,y:-21}},onClick:h=>e.zoomToCluster(m)},null,8,["label","position","icon","onClick"])):(g(),w(o,{key:`m-${m}`,position:s,title:r[0].title||r[0].id,visible:r[0].visible,icon:r[0].icon,label:r[0].label,onClick:h=>r[0].onClick?r[0].onClick(s):null,onContextmenu:h=>r[0].onContextmenu?r[0].onContextmenu(s):null},null,8,["position","title","visible","icon","label","onClick","onContextmenu"]))],64))),256))])}const K=y(A,[["render",D]]);export{K as default};
