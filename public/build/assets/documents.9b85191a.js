import{r as f,c8 as x}from"./index.51e7cafa.js";function k(v={}){const{thumbnailScale:D=.5,enableDflip:y=!0,cdnBaseUrl:w="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174",storageBaseUrl:m=window.location.origin+"/storage",filters:P={type:"document"}}=v,c=f([]),u=f(!1),g=f(null),h=x(),L=async()=>{if(window.pdfjsLib)return window.pdfjsLib;try{return await Promise.all([new Promise(n=>{const t=document.createElement("script");t.src=`${w}/pdf.min.js`,t.onload=n,document.head.appendChild(t)}),new Promise(n=>{const t=document.createElement("script");t.src=`${w}/pdf.worker.min.js`,t.onload=n,document.head.appendChild(t)})]),await new Promise(n=>setTimeout(n,100)),window.pdfjsLib}catch(n){throw console.error("Failed to load PDF.js",n),n}},b=async(n,t=D)=>{try{const r=await L(),o=`${m}/${n}`,e=await(await r.getDocument(o).promise).getPage(1),a=document.createElement("canvas"),s=e.getViewport({scale:t}),d=a.getContext("2d");return a.width=s.width,a.height=s.height,await e.render({canvasContext:d,viewport:s}).promise,a.toDataURL("image/jpeg",.8)}catch(r){return console.error("Error generating thumbnail:",r),null}},j=async n=>{u.value=!0;try{const r=(await n()).map(async e=>{e.slug=e.slug||e.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");let a=0,s=0,d="unknown";try{if(!e.thumbnail_path&&e.publication_file.toLowerCase().endsWith(".pdf")){const l=await b(e.publication_file);e.thumb=l||void 0}else e.thumbnail_path&&(e.thumb=`${m}/${e.thumbnail_path}`);if(e.thumb){const l=F(e.thumb);l&&(s=l.width,a=l.height,d=s>a?"landscape":"portrait")}}catch(l){console.error(`Error processing thumbnail for ${e.name}:`,l)}return{...e,height:a,width:s,orientation:d}}),o=await Promise.all(r),i=o.filter(e=>e.orientation==="portrait").sort((e,a)=>a.height-e.height),p=o.filter(e=>e.orientation==="landscape").sort((e,a)=>a.height-e.height);return c.value=[...i,...p],console.log("Processed documents:",c.value.map(e=>({name:e.name,height:e.height,width:e.width,orientation:e.orientation}))),u.value=!1,c.value}catch(t){return u.value=!1,g.value=t instanceof Error?t:new Error(String(t)),console.error(t),[]}},$=(n=c.value)=>{var t;if(!y||!n.length)return!1;if(n.forEach(r=>{r.publication_file.toLowerCase().endsWith(".pdf")&&(window[`df_option_${r.id}`]={source:`${m}/${r.publication_file}`,outline:[],autoEnableOutline:!1,autoEnableThumbnail:!1,overwritePDFOutline:!1,pageSize:"0",is3D:!0,height:"100",direction:"1",slug:r.slug,wpOptions:"true",id:r.id})}),(t=window.DFLIP)!=null&&t.parseBooks){if(window.DFLIP.parseBooks(),h.currentRoute.value.hash){if(h.currentRoute.value.hash==="#_"){h.replace({hash:""});return}const r=n.find(o=>h.currentRoute.value.hash.includes(o.slug));r&&document.getElementById(`df_${r.id}`).click()}return!0}return console.warn("DFLIP library not loaded"),!1},E=(n,t)=>{var i;const r=document.querySelector(".df-lightbox-wrapper"),o=r&&r.style.display!=="none";return window.DFLIP&&o?((i=document.querySelector(".df-lightbox-close"))==null||i.click(),!1):!0},_=(n="")=>c.value.filter(t=>{const r=Object.entries(P).every(([i,p])=>t[i]===p),o=!n||Object.values(t).some(i=>String(i).toLowerCase().includes(n.toLowerCase()));return r&&o}),F=n=>{const t=n.split("-").pop().split(".jpg")[0].split("x");if(t.length===2){const r=parseFloat(t[0],10),o=parseFloat(t[1],10);if(!isNaN(r)&&!isNaN(o))return{width:r,height:o}}return null};return{documents:c,loading:u,error:g,processDocuments:j,initializeDflip:$,generateThumbnail:b,handleRouteLeave:E,filterDocuments:_}}export{k as u};
