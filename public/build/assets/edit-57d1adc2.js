import{a as y,v as e}from"./index-2f855d2c.js";import"./use-meta-131940dc.js";/* empty css                                     */import{u as B}from"./publications-bf2a0c49.js";import{q as k}from"./vue3-quill-d21dbda8.js";import"./_commonjsHelpers-23102255.js";import"./index-431cc3fd.js";import"./_plugin-vue_export-helper-c27b6911.js";const x={class:"container"},j={class:"container"},P={class:"row"},S={id:"",class:"col-lg-12 layout-spacing layout-top-spacing"},F={class:"statbox panel box box-shadow"},D={class:"panel-body"},L={class:"row"},T={class:"form-group col-md-12"},C={class:"text-danger mt-1"},U={class:"form-group"},M={class:"text-danger mt-1"},A={class:"form-group"},I={class:"text-danger mt-1"},$={class:"custom-file-container","data-upload-id":"myFirstImage"},q={class:"custom-file-container__custom-file",for:"publication_file"},R={class:"mt-1 text-danger"},J={class:"form-group col-md-4"},W={class:"text-danger mt-1"},X=["disabled"],le={__name:"edit",setup(Z){const{publication:o,getPublication:b,updatePublication:g,validationErrors:u,isLoading:v}=B(),p=y(),m=e.ref(!1),N=(n,t)=>{const a=n.split(",")[1],i=atob(a),r=new ArrayBuffer(i.length),c=new Uint8Array(r);for(let l=0;l<i.length;l++)c[l]=i.charCodeAt(l);const s=new Blob([r],{type:"image/jpeg"});return new File([s],t,{type:"image/jpeg"})},h=n=>{const t=n.split("-").pop().split(".jpg")[0].split("x");if(t.length===2){const a=parseFloat(t[0],10),i=parseFloat(t[1],10);if(!isNaN(a)&&!isNaN(i))return{width:a,height:i}}return null};async function V(){var n,t;m.value=!0;try{const a=h(((n=o.value)==null?void 0:n.thumbnail_path)||"");if(typeof o.value.publication_file=="object"||!((t=o.value)!=null&&t.thumbnail_path)||!a){let i,r;if(typeof o.value.publication_file=="object")i=await o.value.publication_file.arrayBuffer(),r=o.value.publication_file.name;else if(typeof o.value.publication_file=="string")i=await(await fetch("/storage/"+o.value.publication_file)).arrayBuffer(),r=o.value.publication_file.split("/").pop();else{console.error("Invalid publication file");return}const{thumbnailBase64:c,width:s,height:l}=await w(i);if(c){const d=`thumbnail-${r.replace(".pdf","")}-${s}x${l}.jpg`,f=N(c,d);o.value.thumbnail_path=f}else{console.error("Failed to generate thumbnail");return}}g(o.value)}catch(a){console.error("Error submitting form:",a)}finally{m.value=!1}}const E=e.ref(null),_=async()=>(window.pdfjsLib||(await Promise.all([new Promise(n=>{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",t.onload=n,document.head.appendChild(t)}),new Promise(n=>{const t=document.createElement("script");t.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",t.onload=n,document.head.appendChild(t)})]),await new Promise(n=>setTimeout(n,100))),window.pdfjsLib),w=async(n,t=.5)=>{try{const a=await _(),i=new Uint8Array(n),s=await(await a.getDocument({data:i}).promise).getPage(1),l=s.getViewport({scale:t}),d=E.value,f=d.getContext("2d");return d.width=l.width,d.height=l.height,await s.render({canvasContext:f,viewport:l}).promise,{thumbnailBase64:d.toDataURL("image/jpeg",.8),width:l.width,height:l.height}}catch(a){return console.error("Error generating thumbnail:",a),null}};return e.onMounted(()=>{b(p.params.id)}),e.watch(()=>p.params.id,n=>{b(p.params.id)}),(n,t)=>{var a,i,r,c,s;return e.openBlock(),e.createElementBlock("div",x,[(e.openBlock(),e.createBlock(e.Teleport,{to:"#breadcrumb"},[t[5]||(t[5]=e.createElementVNode("ul",{class:"navbar-nav flex-row"},[e.createElementVNode("li",null,[e.createElementVNode("div",{class:"page-header"},[e.createElementVNode("nav",{class:"breadcrumb-one","aria-label":"breadcrumb"},[e.createElementVNode("ol",{class:"breadcrumb"},[e.createElementVNode("li",{class:"breadcrumb-item"},[e.createElementVNode("a",{href:"javascript:;"},"Publications")]),e.createElementVNode("li",{class:"breadcrumb-item active","aria-current":"page"},[e.createElementVNode("span",null,"Edit Publication")])])])])])],-1))])),e.createElementVNode("div",j,[e.createElementVNode("div",P,[e.createElementVNode("div",S,[e.createElementVNode("div",F,[t[16]||(t[16]=e.createElementVNode("div",{class:"panel-heading pb-0"},[e.createElementVNode("div",{class:"row"},[e.createElementVNode("div",{class:"col-xl-12 col-md-12 col-sm-12 col-12"},[e.createElementVNode("h3",null,[e.createElementVNode("b",null,"Edit Publication")])])])],-1)),e.createElementVNode("div",D,[e.createElementVNode("form",{onSubmit:e.withModifiers(V,["prevent"])},[e.createElementVNode("div",L,[e.createElementVNode("div",T,[t[6]||(t[6]=e.createElementVNode("label",{for:"post-name"},"Title",-1)),e.withDirectives(e.createElementVNode("input",{id:"post-name","onUpdate:modelValue":t[0]||(t[0]=l=>e.unref(o).name=l),type:"text",class:"form-control",placeholder:"Enter Title ..."},null,512),[[e.vModelText,e.unref(o).name]]),e.createElementVNode("div",C,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((a=e.unref(u))==null?void 0:a.name,l=>(e.openBlock(),e.createElementBlock("div",null,e.toDisplayString(l),1))),256))])]),e.createElementVNode("div",U,[t[8]||(t[8]=e.createElementVNode("label",{for:"post-category",class:"form-label"},"Type",-1)),e.withDirectives(e.createElementVNode("select",{id:"type","onUpdate:modelValue":t[1]||(t[1]=l=>e.unref(o).type=l),class:"form-select form-control",name:"type"},t[7]||(t[7]=[e.createElementVNode("option",{selected:"",disabled:"",value:""}," Select Publication Type ",-1),e.createElementVNode("option",{value:"Brochures"}," Brochures ",-1),e.createElementVNode("option",{value:"Newsletter"}," Newsletter ",-1)]),512),[[e.vModelSelect,e.unref(o).type]]),e.createElementVNode("div",M,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((i=e.unref(u))==null?void 0:i.type,l=>(e.openBlock(),e.createElementBlock("div",null,e.toDisplayString(l),1))),256))])]),e.createElementVNode("div",A,[t[9]||(t[9]=e.createElementVNode("label",{for:"post-content"}," Description",-1)),e.createVNode(e.unref(k),{value:e.unref(o).content,"onUpdate:value":t[2]||(t[2]=l=>e.unref(o).content=l),placeholder:"Enter Blog Content ..."},null,8,["value"]),e.createElementVNode("div",I,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((r=e.unref(u))==null?void 0:r.content,l=>(e.openBlock(),e.createElementBlock("div",null,e.toDisplayString(l),1))),256))])]),e.createElementVNode("div",$,[t[12]||(t[12]=e.createElementVNode("label",null,[e.createTextVNode("Upload File (Must be pdf) "),e.createElementVNode("a",{href:"javascript:void(0)",class:"custom-file-container__image-clear",title:"Clear File"},"x")],-1)),e.createElementVNode("label",q,[e.createElementVNode("input",{id:"publication_file",type:"file",class:"custom-file-container__custom-file__custom-file-input",accept:"application/pdf",onChange:t[3]||(t[3]=l=>e.unref(o).publication_file=l.target.files[0])},null,32),t[10]||(t[10]=e.createElementVNode("input",{type:"hidden",name:"MAX_FILE_SIZE",value:"10485760"},null,-1)),t[11]||(t[11]=e.createElementVNode("span",{class:"custom-file-container__custom-file__custom-file-control"},null,-1))]),e.createElementVNode("div",R,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((c=e.unref(u))==null?void 0:c.publication_file,l=>(e.openBlock(),e.createElementBlock("div",null,e.toDisplayString(l),1))),256))]),t[13]||(t[13]=e.createElementVNode("div",{class:"custom-file-container__image-preview"},null,-1))]),e.createElementVNode("div",J,[t[15]||(t[15]=e.createElementVNode("label",{for:"is_published",class:"col-form-label"},"Publishing Status",-1)),e.createElementVNode("div",null,[e.withDirectives(e.createElementVNode("select",{id:"is_published","onUpdate:modelValue":t[4]||(t[4]=l=>e.unref(o).is_published=l),class:"form-select"},t[14]||(t[14]=[e.createElementVNode("option",{value:""}," Select Publishing Status ... ",-1),e.createElementVNode("option",{selected:"",value:"1"}," Published ",-1),e.createElementVNode("option",{value:"0"}," Not Published ",-1)]),512),[[e.vModelSelect,e.unref(o).is_published]])]),e.createElementVNode("div",W,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList((s=e.unref(u))==null?void 0:s.is_published,l=>(e.openBlock(),e.createElementBlock("div",null,e.toDisplayString(l),1))),256))])])]),e.createElementVNode("canvas",{ref_key:"thumbnailCanvas",ref:E,style:{display:"none"}},null,512),e.createElementVNode("button",{disabled:e.unref(v)||m.value,class:"btn btn-primary mt-3"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(v)||m.value?"Processing...":"Save"),1)],8,X)],32)])])])])])])}}};export{le as default};
